BEGIN;

-- RESET DB --
DROP TABLE IF EXISTS "coffee", "origin", "flavor", "role", "user";

-- CREATE TABLE flavor --
CREATE TABLE "flavor" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" TEXT UNIQUE NOT NULL
);

-- CREATE TABLE origin --
CREATE TABLE "origin" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" TEXT UNIQUE NOT NULL
);

-- CREATE TABLE coffee --
CREATE TABLE "coffee" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" TEXT NOT NULL,
  "reference" INT NOT NULL,
  "description" TEXT NOT NULL,
  "price" NUMERIC(6, 2) NOT NULL, 
  "available" BOOLEAN NOT NULL,
  "origin_id" INT NOT NULL REFERENCES origin(id) ON DELETE CASCADE ON UPDATE CASCADE,
  "flavor_id" INT NOT NULL REFERENCES flavor(id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- CREATE TABLE role --
CREATE TABLE "role" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "name" TEXT UNIQUE NOT NULL DEFAULT 'customer'
);

-- CREATE TABLE user --
CREATE TABLE "user" (
  "id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "email" TEXT UNIQUE NOT NULL,
  "lastname" TEXT NOT NULL,
  "firstname" TEXT NOT NULL,
  "password" TEXT NOT NULL,
  "role_id" INT NOT NULL REFERENCES role(id) ON DELETE CASCADE ON UPDATE CASCADE
);

-- SETUP CHARACTERS ENCODING  --
set client_encoding to utf8;

COMMIT;
-- INSERT INTO in populate.sql --
